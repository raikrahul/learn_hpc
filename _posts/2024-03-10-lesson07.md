---
layout: default
title: "Lesson 7"
date: 2024-03-10
---

## Lesson 7

Lesson 7 content goes here.

### Step 1:

```c
omp_get_thread_num
omp_single
omp_barrier
```

### Step 2:

#### C Code Example:

```c
// filename: count_positives.c
// Compilation instructions: gcc -fopenmp count_positives.c -o count_positives

#include <stdio.h>
#include <omp.h>

int main(int argc, char* argv[]) {
    int rows;
    int cols;
    int data[4][16] = { /* Initialize with different values */ };
    int positive_counts[4] = {0};
    int total_sum = 0;

#pragma omp parallel num_threads(4) shared(rows, cols, data, positive_counts) reduction(+:total_sum)
    {
        // Initialize shared variables using omp single
#pragma omp single
        {
            printf("Initializing data by thread %d.\n", omp_get_thread_num());
            rows = 4;
            cols = 16;
            // Initialize the 2D array 'data' with values.
            // The user should implement the data initialization here.
        }

        int my_row = omp_get_thread_num();
        int j;

        // Calculate positive counts and sum for each row.
        // The user should implement the logic to iterate through the columns
        // and check for positive numbers, updating positive_counts and total_sum.
        for (j = 0; j < cols; j++) {
            // Implement logic to check if data[my_row][j] is positive.
            // If positive, increment positive_counts[my_row] and add to total_sum.
        }

        // Barrier to ensure all threads finish calculation before reporting
#pragma omp barrier

        // Report results from a single thread
#pragma omp single
        {
            printf("Reporting from thread %d.\n", omp_get_thread_num());
            for (int k = 0; k < rows; k++) {
                printf("Row %d has %d positive numbers.\n", k, positive_counts[k]);
            }
        }
    }

    printf("The total sum of positive numbers is %d\n", total_sum);
    return 0;
}
